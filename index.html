<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<title>IP Lookup Tool</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* ---------- CSS START ---------- */

/* Global */
body { font-family: Arial, sans-serif; }
.container { max-width: 900px; }

/* Input */
textarea#ipInput {
    min-height: 100px; 
    max-height: 250px;
    resize: vertical;
}

/* Table */
th, td {
    padding: 8px 5px; 
    text-align: center;
    word-break: break-word;
    font-size: 0.9rem;
}

/* Mobile Card View */
@media (max-width: 575.98px) {
    #resultTable thead { display: none; }
    #resultTable tr {
        display: block;
        margin-bottom: 10px; 
        border: 1px solid #ccc;
        border-radius: 6px;
    }
    #resultTable td {
        display: block !important;
        text-align: right;
        padding: 8px 10px;
    }
    #resultTable td::before {
        content: attr(data-label);
        float: left;
        font-weight: bold;
    }
}

/* ---------- CSS END ---------- */
</style>

</head>
<body class="bg-light p-3 p-md-5">

<!-- Main Container -->
<div class="container bg-white p-4 p-md-5 rounded shadow-lg">

    <div class="border-bottom pb-3 mb-4">
        <h3 class="text-primary">IP Lookup Tool</h3>
    </div>

    <textarea id="ipInput" class="form-control mb-3" rows="4" placeholder="Enter IP addresses, one per line..."></textarea>

    <div class="d-grid gap-2 d-md-block button-group mb-4">
        <button id="lookupBtn" class="btn btn-primary">Lookup IPs</button>
        <button id="exportBtn" class="btn btn-success" disabled>Export to Excel</button>
    </div>

    <div class="table-responsive">
        <table id="resultTable" class="table table-striped table-hover table-bordered caption-top">
            <caption>Lookup Results</caption>
            <thead class="table-primary">
                <tr>
                    <th>IP Address</th>
                    <th>ISP</th>
                    <th>Org</th>
                    <th>Country</th>
                    <th>Region</th>
                    <th>City</th>
                    <th>Latitude</th>
                    <th>Longitude</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<!-- FOOTER -->
<footer class="mt-4 text-center" style="font-size:0.85rem;">
    <a href="https://bush-ballcap-829.notion.site/Hello-I-m-Soe-Moe-Tun-154ba19866024819b26330566b4b1fa1"
       target="_blank"
       style="color:#0d6efd; text-decoration:none; font-weight:600;">
        Developed by Soe Moe Tun
    </a>

    <span style="margin:0 8px; color:#777;">|</span>

    <a href="#" data-bs-toggle="modal" data-bs-target="#guideModal"
       style="color:#0d6efd; text-decoration:none; font-weight:600;">
        Tool Guide Line
    </a>
</footer>
<div class="modal fade" id="guideModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header" style="border-bottom: none;">
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body small" style="line-height:1.45;">

        <h2 class="fw-bold mb-2 fs-5">IP Lookup Tool</h2>
        <p>A simple web tool that lets you check ISP, location, and basic info for multiple IP addresses at once. Paste a list of IPs, click <strong>Lookup IPs</strong>, and get instant results.</p>

        <h5 class="fw-bold mt-3 mb-2 fs-6">üåü Features</h5>
        <ul class="mb-2">
          <li>Enter one or many IP addresses</li>
          <li>Auto-fetch ISP, Country, Region, City, Lat/Long</li>
          <li>Mobile-friendly responsive table</li>
          <li>Error handling</li>
          <li>Export results to Excel</li>
        </ul>

        <h5 class="fw-bold mt-3 mb-2 fs-6">üöÄ How to Use</h5>
        <ol class="mb-2">
          <li>Paste IPs</li>
          <li>Click Lookup</li>
          <li>Review results in the table</li>
          <li>Export to Excel</li>
        </ol>

        <h5 class="fw-bold mt-3 mb-2 fs-6">üìÅ File Structure</h5>
        <ul class="mb-2">
          <li><strong>index.html</strong> ‚Äì Main UI</li>
          <li><strong>CSS (embedded)</strong> ‚Äì Layout & responsiveness</li>
          <li><strong>JS (embedded)</strong> ‚Äì Lookup logic & export</li>
          <li>Uses <strong>Bootstrap</strong> & <strong>SheetJS</strong></li>
        </ul>

        <h5 class="fw-bold mt-3 mb-2 fs-6">üåç API Used</h5>
        <p class="mb-2">Data from <strong>ip-api.com</strong> via AllOrigins proxy.</p>

      </div>

      <div class="modal-footer" style="border-top: none;">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const ipInput = document.getElementById("ipInput");
    const lookupBtn = document.getElementById("lookupBtn");
    const exportBtn = document.getElementById("exportBtn");
    const tbody = document.querySelector("#resultTable tbody");

    let ipLookupResults = [];

    function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

    lookupBtn.addEventListener("click", async () => {

        const ips = ipInput.value.trim().split("\n").map(x => x.trim()).filter(Boolean);

        if (ips.length === 0) return alert("Please enter IP addresses.");

        tbody.innerHTML = "";
        ipLookupResults = [];

        lookupBtn.disabled = true;
        exportBtn.disabled = true;
        lookupBtn.textContent = "Looking up...";

        for (const ip of ips) {

            let dataRow = {
                ip, isp:"N/A", org:"N/A",
                country:"N/A", regionName:"N/A",
                city:"N/A", lat:"N/A", lon:"N/A"
            };

            const row = document.createElement("tr");

            if (!/^\d{1,3}(\.\d{1,3}){3}$/.test(ip)) {
                row.classList.add("table-danger");
                row.innerHTML = `<td>${ip}</td><td colspan="7">Invalid IP</td>`;
                tbody.appendChild(row);
                ipLookupResults.push(dataRow);
                continue;
            }

            try {
                const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`http://ip-api.com/json/${ip}`)}`;
                const res = await fetch(url);
                const json = await res.json();
                const data = JSON.parse(json.contents);

                if (data.status === "success") {
                    dataRow = {
                        ip: data.query,
                        isp: data.isp,
                        org: data.org,
                        country: data.country,
                        regionName: data.regionName,
                        city: data.city,
                        lat: data.lat,
                        lon: data.lon
                    };

                    row.innerHTML = `
                        <td data-label="IP Address">${dataRow.ip}</td>
                        <td data-label="ISP">${dataRow.isp}</td>
                        <td data-label="Org">${dataRow.org}</td>
                        <td data-label="Country">${dataRow.country}</td>
                        <td data-label="Region">${dataRow.regionName}</td>
                        <td data-label="City">${dataRow.city}</td>
                        <td data-label="Latitude">${dataRow.lat}</td>
                        <td data-label="Longitude">${dataRow.lon}</td>
                    `;
                } else {
                    row.classList.add("table-warning");
                    row.innerHTML = `<td>${ip}</td><td colspan="7">Failed</td>`;
                }

            } catch (err) {
                row.classList.add("table-danger");
                row.innerHTML = `<td>${ip}</td><td colspan="7">Network Error</td>`;
            }

            tbody.appendChild(row);
            ipLookupResults.push(dataRow);

            await delay(1000);
        }

        lookupBtn.disabled = false;
        lookupBtn.textContent = "Lookup IPs";
        exportBtn.disabled = false;
    });

    exportBtn.addEventListener("click", () => {

        const dataForExport = [
            ["IP", "ISP", "Org", "Country", "Region", "City", "Latitude", "Longitude"],
            ...ipLookupResults.map(x => [
                x.ip, x.isp, x.org, x.country,
                x.regionName, x.city, x.lat, x.lon
            ])
        ];

        const ws = XLSX.utils.aoa_to_sheet(dataForExport);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Results");

        XLSX.writeFile(wb, "IP_Lookup.xlsx");
    });

});
</script>

</body>
</html>
